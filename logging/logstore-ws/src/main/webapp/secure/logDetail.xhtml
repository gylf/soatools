<?xml version="1.0" encoding="utf-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html" xmlns:s="http://jboss.com/products/seam/taglib"
  xmlns:f="http://java.sun.com/jsf/core" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich"
  template="template.xhtml">

  <ui:define name="title">LogStore console</ui:define>
  <ui:define name="header">
    <style type="text/css">
h2.message {
	color: red
}

table.message {
	border: 2px solid black
}

th.message {
	background: lightgray
}

td.message {
	border: 1px solid black;
	vertical-align: top
}

td.section {
	background: lightgray;
	border: 0px;
	vertical-align: top
}

span.element {
	color: blue
}

span.attribute {
	color: red
}

div.message {
	border-top: 1px solid black;
	border-bottom: 1px solid black;
	margin-bottom: 10px;
	padding-bottom: 5px;
	width: 100%
}

div.pbox,div.pbox_s,div.pbox_e {
	position: absolute;
	border-width: 1px;
	border-style: solid;
}

div.pbox {
	border-color: #0000ff;
}

div.pbox_s {
	border-color: #aa6600;
}

div.pbox_e {
	border-color: #cc0000;
}

div.pboxs,div.pboxs_s,div.pboxs_e {
	position: absolute;
	border-right-width: 1px;
	border-right-style: solid;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

div.pboxs {
	border-right-color: #9999ff;
	border-bottom-color: #9999ff;
}

div.pboxs_s {
	border-right-color: #ffaa99;
	border-bottom-color: #ffaa99;
}

div.pboxs_e {
	border-right-color: #660000;
	border-bottom-color: #660000;
}

div.pboxce {
	position: absolute;
	overflow: hidden;
}

div.pboxc,div.pboxc_s,div.pboxc_e {
	cursor: default;
	font-size: 10px;
	white-space: nowrap;
	color: #ffffff;
	padding-left: 3px;
	padding-right: 3px;
	border-width: 1px;
	border-style: solid;
}

div.pboxc {
	border-color: #0000ff;
	background-color: #0000ff;
}

div.pboxc_s {
	border-color: #aa6600;
	background-color: #aa6600;
}

div.pboxc_e {
	border-color: #cc0000;
	background-color: #cc0000;
}

div.pboxc a,div.pboxc_s a,div.pboxc_e a {
	color: #ffffff;
	text-decoration: none;
}

div.pboxc a:hover,div.pboxc_s a:hover,div.pboxc_e a:hover {
	text-decoration: underline;
}

</style>
  </ui:define>
  <ui:define name="contentDetail">
    <h:form>
      <rich:tabPanel>
        <rich:tab label="Single">
          <h:commandButton action="#{logStoreLogDetail.close}" value="Close" />
          <a4j:region renderRegionOnly="true">
            <rich:dataTable value="#{logMessageList.logMessages}" var="logMessage" rowClasses="first,second"
              columnClasses="narrow,wide" rows="20">
              <rich:column>
                <h:outputText value="*" rendered="#{logMessage.id == logMessageList.current.id}"/>
              </rich:column>
              <rich:column>
                <f:facet name="header">Id</f:facet>
              #{logMessage.id}
            </rich:column>
              <rich:column>
                <f:facet name="header">Service</f:facet>
                <a4j:commandLink action="#{logStoreLogDetail.select(logMessage)}" reRender="logMessageDetail" rendered="#{logMessage.id != logMessageList.current.id}">
                   #{logMessage.serviceCategory} : #{logMessage.serviceName}
                </a4j:commandLink>
                <h:outputText value="#{logMessage.serviceCategory} : #{logMessage.serviceName}" rendered="#{logMessage.id == logMessageList.current.id}"/>
              </rich:column>
              <rich:column>
                <f:facet name="header">State</f:facet>
                #{logMessage.state}
              </rich:column>
              <rich:column>
                <f:facet name="header">Enter</f:facet>
                #{logMessage.logEnterTimestamp}
              </rich:column>
              <rich:column>
                <f:facet name="header">Leave</f:facet>
                #{logMessage.logLeaveTimestamp}
              </rich:column>
              <f:facet name="footer">
                <rich:datascroller pageIndexVar="pageIndex" pagesVar="pages">
                  <f:facet name="pages">
                    <h:outputText value="#{pageIndex} / #{pages}"></h:outputText>
                  </f:facet>
                </rich:datascroller>
              </f:facet>
            </rich:dataTable>
            <h:panelGroup id="logMessageDetail" rendered="#{logMessageList.hasCurrent}">
              <rich:tabPanel switchType="ajax" selectedTab="#{logStoreLogDetail.selectedDetailTab}">
                <rich:tab label="Summary">
                  <ui:include src="decorators/decorators.xhtml">
                    <ui:param name="logMessage" value="#{logMessageList.current}" />
                  </ui:include>
                </rich:tab>
                <rich:tab label="Detail">
                  <ui:include src="logMessageDetail.xhtml">
                    <ui:param name="logMessage" value="#{logMessageList.current}" />
                  </ui:include>
                </rich:tab>
                <rich:tab label="Process" rendered="#{logMessageList.current.hasProcessInformation}">
                  <ui:fragment>
                    <ui:param name="diagramInfo"
                      value="#{processInformation.getDiagramInfo(logMessageList.current.jbpmProcessInstanceId)}" />
                    <ui:param name="nodeName" value="#{diagramInfo.nodeNames[logMessageList.current.jbpmNodeId]}" />
                    <ui:param name="node" value="#{diagramInfo.nodeMap[nodeName]}" />

                    <table border="0">
                      <tr>
                        <td>
                        <table border="0">
                          <tr>
                            <td>Process Name:</td>
                          </tr>
                          <tr>
                            <td>#{diagramInfo.processDefinitionName}</td>
                          </tr>
                          <tr>
                            <td>Process Version:</td>
                          </tr>
                          <tr>
                            <td>#{diagramInfo.processDefinitionVersion}</td>
                          </tr>
                          <tr>
                            <td>Node:</td>
                          </tr>
                          <tr>
                            <td>#{nodeName}</td>
                          </tr>
                          <tr>
                            <td></td>
                          </tr>
                        </table>
                        </td>
                        <td>
                        <div style="position:relative;height:#{diagramInfo.height}px;width:#{diagramInfo.width}px}">
                          <img alt=""
                            src="#{request.getContextPath()}/processFile/#{diagramInfo.processDefinitionId}/processimage.jpg"
                            style="top: 0; left: 0" />
                          <div style="top:#{node.y - 12}px;left:#{node.x + 2}px;width:#{node.width - 3}px;height:#{node.height + 11}px" class="pboxs"/>
                          <div style="top:#{node.y}px;left:#{node.x}px;width:#{node.width - 3}px;height:#{node.height - 3}px" class="pbox"/>
                          <div style="top:#{node.y - 14}px;left:#{node.x}px;width:#{node.width - 1}px" class="pboxce">
                            <div style="" class="pboxc">
                              #{logMessageList.current.id}
                            </div>
                          </div>
                        </div>
                        </td>
                      </tr>
                    </table>
                  </ui:fragment>
                </rich:tab>
              </rich:tabPanel>
            </h:panelGroup>
          </a4j:region>
        </rich:tab>
        <rich:tab label="All">
          <nl> <ui:repeat var="logMessage" value="#{logMessageList.logMessages}">
            <li><a href="##{logMessage.id}"> #{logMessage.serviceCategory} : #{logMessage.serviceName} </a></li>
          </ui:repeat> </nl>

          <table>
            <ui:repeat var="logMessage" value="#{logMessageList.logMessages}">
              <div class="message">
              <h2 class="message"><a name="#{logMessage.id}">#{logMessage.serviceCategory} :
              #{logMessage.serviceName}</a></h2>
              <ui:include src="decorators/decorators.xhtml" /> <ui:include src="logMessageDetail.xhtml" /></div>
            </ui:repeat>
          </table>
        </rich:tab>
      </rich:tabPanel>
    </h:form>
  </ui:define>
</ui:composition>